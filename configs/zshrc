# Author: James Campbell
# Date Updated: 2019-11-14
# Reason: Updated Fresh Mac installer with latest and greatest stuff

export ZSH=$HOME/.oh-my-zsh

ZSH_THEME="ys"
ENABLE_CORRECTION="true"
COMPLETION_WAITING_DOTS="true"
DISABLE_AUTO_TITLE="true"
plugins=(git vscode taskwarrior rand-quote redis-cli)

# oh my zsh stuff (only source if oh-my-zsh is installed)
if [ -d "$ZSH" ] && [ -f "$ZSH/oh-my-zsh.sh" ]; then
    source $ZSH/oh-my-zsh.sh
else
    echo "Warning: oh-my-zsh not found. Install it with:"
    echo "  sh -c \"\$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\""
fi
export LANG=en_US.UTF-8

# pure prompt init (brew install pure)
autoload -U promptinit; promptinit
prompt pure
# default is blue so we make it green
zstyle :prompt:pure:path color green

# aliases
alias cat="bat"
alias ls="exa"
alias l="exa -lahF"
alias of="open -a Finder ."
alias clr="clear"
alias svr="python3 -m http.server 8000"
alias retor="pidof tor | xargs sudo kill -HUP"
alias cleanquote="quote | sed 's/.*“\(.*\)”.*/\1/g'"

# fixes for forward and back
bindkey '^[^[[D' emacs-backward-word
bindkey '^[^[[C' emacs-forward-word

# exports
export PATH="/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:$PATH"
# Add uv tools bin directory to PATH
if [ -d "$HOME/.local/bin" ]; then
    export PATH="$HOME/.local/bin:$PATH"
fi
# Add system Python user site-packages to PATH (detects current Python version)
if command -v python3 &> /dev/null; then
    PYTHON_VERSION=$(python3 -c "import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')" 2>/dev/null || echo "3")
    if [ -d "$HOME/Library/Python/$PYTHON_VERSION/bin" ]; then
        export PATH="$HOME/Library/Python/$PYTHON_VERSION/bin:$PATH"
    fi
fi
export PATH="$PATH:$HOME/.rvm/bin" # Add RVM to PATH for scripting
# Load RVM into a shell session *as a function* (required for RVM to work)
[[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm"
# Set up build environment for Ruby compilation (OpenSSL, readline, etc.)
if command -v brew &> /dev/null; then
    HOMEBREW_PREFIX=$(brew --prefix 2>/dev/null || echo "/usr/local")
    OPENSSL_PREFIX=$(brew --prefix openssl@3 2>/dev/null || echo "$HOMEBREW_PREFIX/opt/openssl@3")
    if [ -d "$OPENSSL_PREFIX" ]; then
        export PATH="$OPENSSL_PREFIX/bin:$PATH"
        export LDFLAGS="-L$OPENSSL_PREFIX/lib ${LDFLAGS:-}"
        export CPPFLAGS="-I$OPENSSL_PREFIX/include ${CPPFLAGS:-}"
        export PKG_CONFIG_PATH="$OPENSSL_PREFIX/lib/pkgconfig:${PKG_CONFIG_PATH:-}"
        # Configure RVM to use OpenSSL 3 for Ruby compilation
        if [ -d "$HOME/.rvm" ]; then
            mkdir -p "$HOME/.rvm/user"
            echo "rvm_configure_flags+=(--with-openssl-dir=$OPENSSL_PREFIX)" > "$HOME/.rvm/user/db"
        fi
    fi
fi
export PATH="$PATH:$HOME/bin" # added sculpin
# Go configuration (dynamic for Apple Silicon and Intel Macs)
export GOPATH=$HOME/golang
# Set GOROOT based on Homebrew prefix (works for both Apple Silicon and Intel)
if command -v brew &> /dev/null; then
    HOMEBREW_PREFIX=$(brew --prefix 2>/dev/null || echo "/usr/local")
    if [ -d "$HOMEBREW_PREFIX/opt/go/libexec" ]; then
        export GOROOT="$HOMEBREW_PREFIX/opt/go/libexec"
        export PATH="$PATH:$GOROOT/bin"
    fi
fi
export PATH="$PATH:$GOPATH/bin"
export SLUGIFY_USES_TEXT_UNIDECODE=yes

# iTerm2 tab titles
function title ()
{
    TITLE=$*;
    export PROMPT_COMMAND='echo -ne "\033]0;$TITLE\007"'
}

setTerminalText () {
    # echo works in bash & zsh
    local mode=$1 ; shift
    echo -ne "\033]$mode;$@\007"
}
stt_both  () { setTerminalText 0 $@; }
stt_tab   () { setTerminalText 1 $@; }
stt_title () { setTerminalText 2 $@; }

export PATH="/usr/local/sbin:$PATH"
# Python 2.7 and Python 3.5 are EOL - removed outdated paths
# Use pyenv or system Python 3.12+ (LTS) instead

# node version control
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm

# added by travis gem
[ -f $HOME/.travis/travis.sh ] && source /Users/$USER/.travis/travis.sh
eval "$(/opt/homebrew/bin/brew shellenv)"
# pyenv configuration (only if pyenv is installed)
if command -v pyenv &> /dev/null || [ -d "$HOME/.pyenv" ]; then
    export PYENV_ROOT="$HOME/.pyenv"
    [[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"
    # Only set brew alias if pyenv is actually available
    if command -v pyenv &> /dev/null; then
        alias brew='env PATH="${PATH//$(pyenv root)\/shims:/}" brew'
    fi
    eval "$(pyenv init -)" 2>/dev/null || true
fi